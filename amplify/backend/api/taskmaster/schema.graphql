
type TaskList
  @model
  @auth(rules: [
    { allow: owner, ownerField: "owner", identityClaim: "sub" },
    { allow: groups, groups: ["Admin"] }
  ]) {
  id: ID! @primaryKey

  name: String!
  isDemo: Boolean!
  isFavorite: Boolean!
  sortOrder: Int!

  tasks: [Task] @hasMany(indexName: "byList", fields: ["id"])
}

type Task
  @model
  @auth(rules: [
    { allow: owner, ownerField: "owner", identityClaim: "sub" },
    { allow: groups, groups: ["Admin"] }
  ]) {
  id: ID! @primaryKey

  # Query tasks in a list ordered by sortOrder
  listId: ID! @index(name: "byList", sortKeyFields: ["sortOrder"], queryField: "tasksByList")
  sortOrder: Int!

  # Query subtasks ordered by sortOrder
  parentTaskId: ID @index(name: "byParent", sortKeyFields: ["sortOrder"], queryField: "tasksByParent")

  title: String!
  description: String
  status: TaskStatus!
  priority: TaskPriority!

  dueAt: AWSDateTime
  completedAt: AWSDateTime

  assigneeId: String
  tagIds: [String!]!

  isDemo: Boolean!

  list: TaskList @belongsTo(fields: ["listId"])

  # OPTIONAL (not needed for MVP; safe to omit for now)
  # parentTask: Task @belongsTo(fields: ["parentTaskId"])
}

type UserProfile
  @model
  @auth(rules: [
    { allow: owner, ownerField: "owner", identityClaim: "sub" },
    { allow: groups, groups: ["Admin"] }
  ]) {
  # Use the Cognito sub as the record id
  id: ID! @primaryKey

  owner: String

  planTier: PlanTier!
  defaultVisibility: DefaultVisibility!

  # demo seeding + upgrades
  seedVersion: Int!            # 0 = not seeded; bump when seed recipe changes
  seededAt: AWSDateTime        # timestamp of last successful seeding

  # onboarding seeding + upgrades
  onboardingVersion: Int!        # 0 = not seeded; bump when seed recipe changes
  onboarding: AWSJSON
  onboardingUpdatedAt: AWSDateTime

  # settings blob + updates
  settingsVersion: Int!        # 0 = not seeded; bump when seed recipe changes
  settings: AWSJSON
  settingsUpdatedAt: AWSDateTime

  # optional profile fields
  displayName: String
  avatarUrl: String
  lastSeenAt: AWSDateTime
  preferredName: String
  bio: String
  timezone: String
  locale: String

  # app lifecycle + analytics
  lastDeviceId: String
  acceptedTermsAt: AWSDateTime
}

enum TaskStatus {
  Open
  Done
}

enum TaskPriority {
  Low
  Medium
  High
}

enum PlanTier {
  FREE
  DEMO
  PRO
}

enum DefaultVisibility {
  PRIVATE
  TEAM
  PUBLIC
}